<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Controle de Manuten√ß√£o</title>

<!-- Supabase CDN -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>

<h2>Nova Manuten√ß√£o</h2>

<input type="text" id="titulo" placeholder="T√≠tulo"><br><br>
<textarea id="descricao" placeholder="Descri√ß√£o"></textarea><br><br>
<input type="file" id="foto"><br><br>

<button onclick="salvar()">Salvar</button>

<script>
/* üîë CONFIG */
const SUPABASE_URL = "https://yydwtytjrjsbwycnfxlk.supabase.co";
const SUPABASE_KEY = "SUA_ANON_KEY_AQUI";

/* ‚úÖ CRIA CLIENTE UMA √öNICA VEZ */
const supabaseClient = supabase.createClient(
  SUPABASE_URL,
  SUPABASE_KEY
);

async function salvar() {
  const titulo = document.getElementById("titulo").value;
  const descricao = document.getElementById("descricao").value;
  const file = document.getElementById("foto").files[0];

  if (!file) {
    alert("Selecione uma imagem");
    return;
  }

  const fileName = Date.now() + "_" + file.name;

  /* ‚¨ÜÔ∏è Upload */
  const { error: uploadError } = await supabaseClient
    .storage
    .from("manutencoes")
    .upload(fileName, file);

  if (uploadError) {
    console.error(uploadError);
    alert("Erro no upload");
    return;
  }

  /* üîó URL p√∫blica */
  const { data: urlData } = supabaseClient
    .storage
    .from("manutencoes")
    .getPublicUrl(fileName);

  /* üíæ Inser√ß√£o no banco */
  const { data, error } = await supabaseClient
    .from("manutencoes")
    .insert([{
      titulo,
      descricao,
      foto_url: urlData.publicUrl
    }])
    .select();

  if (error) {
    console.error(error);
    alert("Erro ao salvar no banco");
  } else {
    console.log("SALVO:", data);
    alert("Salvo com sucesso!");
  }
}
</script>

</body>
</html>
